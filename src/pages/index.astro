---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.jsx";
import ScrollSection from "../components/ScrollSection.jsx";
import BlogGrid from "../components/BlogGrid.jsx";

// Importez la fonction native d'Astro pour lire les collections
import { getCollection } from "astro:content";
// Récupérez les articles de blog depuis la collection "blog"
const posts = await getCollection("blog");

// Triez les articles par titre (ou par date si vous ajoutez une propriété 'date' au frontmatter)
posts.sort((a, b) => b.data.title.localeCompare(a.data.title));
// Si vous aviez un champ 'date': posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Mappez les collections pour obtenir le format attendu par votre composant <BlogGrid />
// Note : Le slug est maintenant dans a.slug, et les autres données dans a.data
const blogPosts = posts.map((post) => ({
	title: post.data.title,
	slug: post.slug,
	excerpt: post.data.excerpt,
	// Ajoutez d'autres champs si nécessaire (ex: image: post.data.image)
}));
---

<BaseLayout>
	<main>
		<Hero client:only="react" />

		<ScrollSection id="about" title="About">
			<div class="container">
				<p>
					Kintegra — Knowledge integration & Transdisciplinary. We help organisations combine
					expertise across domains to deliver elegant, robust solutions.
				</p>
			</div>
		</ScrollSection>

		<ScrollSection id="blog" title="Blog">
			<div class="container">
				{/* Passez la nouvelle variable blogPosts au composant */}
				<BlogGrid posts={blogPosts} client:load />
			</div>
		</ScrollSection>

		<ScrollSection id="contact" title="Contact">
			<div class="container contact-grid">
				<form class="contact-form">
					<label>Name<input name="name" /></label>
					<label>Email<input name="email" type="email" /></label>
					<label>Message<textarea name="message"></textarea></label>
					<button type="submit" class="btn">Send</button>
				</form>
				<div class="contact-info">
					<h4>Get in touch</h4>
					<p>hello@kintegra.example</p>
				</div>
			</div>
		</ScrollSection>
	</main>
</BaseLayout>
